<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 480">
  <defs>
    <style>
      .label { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; letter-spacing: 0.5px; }
      .box-text { font: 600 13px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .box-text-small { font: 500 11px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .title { font: 600 12px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; letter-spacing: 1px; }
      .subtitle { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; }
      .weight { font: 700 14px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .input-text { font: 500 9px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <marker id="arrow-trend" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0d9488"/>
    </marker>
    <marker id="arrow-revert" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0891b2"/>
    </marker>
    <marker id="arrow-crisis" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#db2777"/>
    </marker>

    <!-- Dots pattern for Meta Agent -->
    <pattern id="dots" width="8" height="8" patternUnits="userSpaceOnUse">
      <circle cx="4" cy="4" r="1.2" fill="#0891b2" opacity="0.4"/>
    </pattern>

    <!-- Diagonal lines for Trend Agent -->
    <pattern id="diagonal-trend" width="6" height="6" patternUnits="userSpaceOnUse">
      <line x1="0" y1="6" x2="6" y2="0" stroke="#0d9488" stroke-width="0.8" opacity="0.5"/>
    </pattern>

    <!-- Horizontal lines for Mean Revert Agent -->
    <pattern id="horizontal-revert" width="6" height="6" patternUnits="userSpaceOnUse">
      <line x1="0" y1="3" x2="6" y2="3" stroke="#0891b2" stroke-width="0.8" opacity="0.5"/>
    </pattern>

    <!-- Crosshatch for Crisis Agent -->
    <pattern id="crosshatch-crisis" width="6" height="6" patternUnits="userSpaceOnUse">
      <line x1="0" y1="0" x2="6" y2="6" stroke="#db2777" stroke-width="0.6" opacity="0.4"/>
      <line x1="6" y1="0" x2="0" y2="6" stroke="#db2777" stroke-width="0.6" opacity="0.4"/>
    </pattern>
  </defs>

  <!-- White background -->
  <rect width="680" height="480" fill="#fff"/>

  <!-- Title -->
  <text x="340" y="28" class="title" text-anchor="middle">META-AGENT REGIME ROUTING</text>
  <text x="340" y="44" class="subtitle">Meta-Agent State Routing Decision</text>

  <!-- Meta Agent - Large box at top -->
  <rect x="90" y="60" width="500" height="130" fill="#a5f3fc" stroke="#1a1a1a" stroke-width="1.5"/>
  <rect x="90" y="60" width="500" height="130" fill="url(#dots)"/>

  <!-- Meta Agent title -->
  <text x="340" y="85" class="box-text">Meta Agent</text>
  <text x="340" y="100" class="label">REGIME DETECTION + TASK ROUTING</text>

  <!-- Input section inside Meta Agent -->
  <rect x="105" y="110" width="145" height="70" fill="#fff" stroke="#ccc" stroke-width="1" rx="2"/>
  <text x="177" y="128" class="box-text-small">INPUT</text>
  <text x="115" y="145" class="input-text">- OHLCV Price Data</text>
  <text x="115" y="158" class="input-text">- ADX, Volatility, Correlation</text>
  <text x="115" y="171" class="input-text">- VIX, Rates, Credit Spread</text>

  <!-- Output section inside Meta Agent -->
  <rect x="265" y="110" width="160" height="70" fill="#fff" stroke="#ccc" stroke-width="1" rx="2"/>
  <text x="345" y="128" class="box-text-small">OUTPUT</text>
  <text x="275" y="145" class="input-text">- State: trending</text>
  <text x="275" y="158" class="input-text">- Probability: [0.6, 0.3, 0.1]</text>
  <text x="275" y="171" class="input-text">- Route: Activate Expert Agent</text>

  <!-- Current regime indicator -->
  <rect x="440" y="110" width="135" height="70" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5" rx="2"/>
  <text x="507" y="128" class="box-text-small" style="fill: #3b82f6;">Current State</text>
  <text x="507" y="152" class="weight" style="fill: #0d9488;">TRENDING</text>
  <text x="507" y="172" class="label" style="fill: #3b82f6;">Confidence: 60%</text>

  <!-- Routing arrows to Expert Agents with weights -->
  <!-- Arrow to Trend Agent (thick, emphasized) -->
  <line x1="200" y1="190" x2="130" y2="260" stroke="#0d9488" stroke-width="3" marker-end="url(#arrow-trend)"/>
  <rect x="120" y="210" width="55" height="22" fill="#5eead4" stroke="#0d9488" stroke-width="1" rx="2"/>
  <text x="147" y="225" class="weight" style="fill: #0d9488;">60%</text>

  <!-- Arrow to Mean Revert Agent (medium) -->
  <line x1="340" y1="190" x2="340" y2="260" stroke="#0891b2" stroke-width="2" marker-end="url(#arrow-revert)"/>
  <rect x="313" y="210" width="55" height="22" fill="#67e8f9" stroke="#0891b2" stroke-width="1" rx="2"/>
  <text x="340" y="225" class="weight" style="fill: #0891b2;">30%</text>

  <!-- Arrow to Crisis Agent (thin) -->
  <line x1="480" y1="190" x2="550" y2="260" stroke="#db2777" stroke-width="1.5" marker-end="url(#arrow-crisis)"/>
  <rect x="505" y="210" width="55" height="22" fill="#f9a8d4" stroke="#db2777" stroke-width="1" rx="2"/>
  <text x="533" y="225" class="weight" style="fill: #db2777;">10%</text>

  <!-- Expert Agents -->
  <!-- Trend Agent - Emphasized with thicker border -->
  <rect x="55" y="275" width="150" height="85" fill="#5eead4" stroke="#0d9488" stroke-width="2.5"/>
  <rect x="55" y="275" width="150" height="85" fill="url(#diagonal-trend)"/>
  <text x="130" y="305" class="box-text">Trend Agent</text>
  <text x="130" y="325" class="label">Trend Following Expert</text>
  <text x="130" y="348" class="box-text-small" style="fill: #0d9488;">Weight: 60%</text>

  <!-- Mean Revert Agent -->
  <rect x="265" y="275" width="150" height="85" fill="#67e8f9" stroke="#1a1a1a" stroke-width="1.5"/>
  <rect x="265" y="275" width="150" height="85" fill="url(#horizontal-revert)"/>
  <text x="340" y="305" class="box-text">Mean Revert</text>
  <text x="340" y="325" class="label">Mean Reversion Expert</text>
  <text x="340" y="348" class="box-text-small" style="fill: #0891b2;">Weight: 30%</text>

  <!-- Crisis Agent -->
  <rect x="475" y="275" width="150" height="85" fill="#f9a8d4" stroke="#1a1a1a" stroke-width="1.5"/>
  <rect x="475" y="275" width="150" height="85" fill="url(#crosshatch-crisis)"/>
  <text x="550" y="305" class="box-text">Crisis Agent</text>
  <text x="550" y="325" class="label">Crisis Defense Expert</text>
  <text x="550" y="348" class="box-text-small" style="fill: #db2777;">Weight: 10%</text>

  <!-- Weighted combination indicator -->
  <line x1="130" y1="360" x2="130" y2="395" stroke="#666" stroke-width="1.5"/>
  <line x1="340" y1="360" x2="340" y2="395" stroke="#666" stroke-width="1.5"/>
  <line x1="550" y1="360" x2="550" y2="395" stroke="#666" stroke-width="1.5"/>

  <line x1="130" y1="395" x2="340" y2="420" stroke="#666" stroke-width="1.5"/>
  <line x1="340" y1="395" x2="340" y2="420" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="550" y1="395" x2="340" y2="420" stroke="#666" stroke-width="1.5"/>

  <!-- Combined output -->
  <rect x="190" y="430" width="300" height="40" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5" rx="2"/>
  <text x="340" y="455" class="box-text-small">Weighted Signal = 0.6*Trend + 0.3*Revert + 0.1*Crisis</text>

  <!-- Legend -->
  <g transform="translate(60, 455)">
    <line x1="0" y1="5" x2="25" y2="5" stroke="#0d9488" stroke-width="3"/>
    <text x="32" y="9" class="label" text-anchor="start">Primary Route</text>

    <line x1="110" y1="5" x2="135" y2="5" stroke="#0891b2" stroke-width="2"/>
    <text x="142" y="9" class="label" text-anchor="start">Secondary Route</text>

    <line x1="220" y1="5" x2="245" y2="5" stroke="#db2777" stroke-width="1.5"/>
    <text x="252" y="9" class="label" text-anchor="start">Backup Route</text>
  </g>
</svg>
